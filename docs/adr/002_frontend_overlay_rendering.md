# ADR 002: Рендеринг оверлеев и управление ассетами

* Статус: Принято
* Дата: 2026-01-27

## Контекст
Система должна отображать визуальные подсказки (текст, картинки) поверх видео.
Логика "когда показывать" находится в Python (GameEngine), так как она привязана к игровому времени.
Рендеринг находится в C# (Avalonia), так как это слой представления.

Проблема: Python отправляет относительные пути (`assets/icon.png`), но C# работает с распакованными файлами во временной директории.

## Решение

1. **Разделение ответственности:**
   - **Backend** фильтрует события таймлайна и отправляет их в метаданных кадра как JSON. Он передает `props` (x, y, scale, rotation) "как есть".
   - **Frontend** получает JSON, десериализует его в `OverlayItem` и мапит пути к файлам на локальную файловую систему.

2. **Управление ассетами:**
   - При загрузке уровня (`LoadLevelAsync`) Frontend распаковывает **все** ассеты из `.mtp` во временную папку.
   - `MainWindowViewModel` хранит путь к корню распакованной папки (`_currentLevelRoot`).
   - При создании `OverlayItem` этот корень передается внутрь для разрешения путей картинок.

3. **Координатная система:**
   - Используется нормализованная система (0.0 - 1.0).
   - Frontend масштабирует это в абсолютные пиксели (1000x1000 Canvas) внутри `Viewbox`.

## Последствия
- (+) Картинки грузятся корректно.
- (+) Python не знает о файловой системе клиента.
- (-) Требуется полное извлечение ассетов при загрузке уровня (время загрузки может чуть вырасти).