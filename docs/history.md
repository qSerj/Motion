# История разработки Motion Trainer (конспект по history.txt)

Документ собран на основе переписки в `docs/history.txt` и отражает ключевые этапы, решения и текущую ревизию проекта. Этот файл — короткая «история разработки», предназначенная для поддержания общего контекста. 

## 1) Хронология и этапы

### Этап 0 — MVP-скрипт и доказательство идеи
- Старт с простого Python‑скрипта: webcam → MediaPipe Pose → скелет поверх видео. 
- Решение ядра скоринга: сравнивать **углы суставов**, а не координаты (инвариантность к росту/дистанции). 
- Введены базовые градации точности (Perfect / Good / Miss) на основе дельты углов. 

### Этап 1 — Уточнение ТЗ и «production‑like» направление
- Уточнены цели: не только игра, но и **терапевтические сценарии** (СДВГ, тренировка внимания, смена поз). 
- Появилось требование **мультиплатформенности** (Windows/Linux, перспективно Android). 
- Запрошена возможность **оцифровки из видеофайлов**, а не только из live‑камеры. 
- Добавлены идеи: регулируемая скорость/метроном, поддержка сторонних устройств (танцевальные коврики), гипотетически мобильные камеры. 

### Этап 2 — Архитектурный поворот
- Принято, что чистый Python‑UI не решает проблему Android/Web. 
- Принцип: **клиент‑сервер или гибрид** (ядро обработки отдельно, UI отдельно). 
- Намечены крупные этапы: «Digitizer» (оцифровка), «Trainer» (игровой режим), «Party Mode», «VR & Expansion». 

### Этап 3 — «Modular Monolith» и «Ports & Adapters»
- Отказ от микросервисов ради производительности (real‑time), выбор **модульного монолита**. 
- Идея: единое ядро, но четкие границы модулей (адаптеры входа/выхода). 
- Планирование поддержки разных источников данных (webcam, видео, потенциально VR‑датчики) без переписывания ядра. 

### Этап 4 — Текущая архитектура в репозитории
- Backend: Python (CV/логика), IPC через ZeroMQ (PUB/REP). 
- Frontend: Avalonia (C#) как десктоп‑клиент, умеющий отображать видео/оверлеи и редактировать таймлайн. 
- Формат контента: `.mtp v2` (ZIP‑архив) с manifest/timeline/assets/video. 
- Документированы решения в ADR (например, рендеринг оверлеев). 

## 2) Ключевые проектные решения

1. **Сравнение по углам** вместо координат — устойчивость к масштабу и дистанции. 
2. **Модульный монолит** вместо микросервисов — производительность + возможность последующего выделения модулей. 
3. **Ports & Adapters** как принцип расширяемости (входы: webcam/video/VR; выходы: UI/web/VR). 
4. **Клиент‑серверное взаимодействие** для UI и ядра (IPC через ZeroMQ). 
5. **Контент как формат**: `.mtp v2` с манифестом и таймлайном — единый контракт для backend/frontend. 
6. **Рендеринг оверлеев на фронте** (Avalonia), ассеты распаковываются локально, backend отдает только ссылки/метаданные. 

## 3) Выжимка идей (backlog/visions)

- **Мультиплатформенный UI**: Windows/Linux, перспективно Android. 
- **Web‑обертка** или desktop‑обертка (Electron/PWA/TWA) — как возможный будущий путь UI. 
- **Оцифровка из видеофайлов** (Just Dance и похожие источники). 
- **Групповые режимы** (Party Mode) с трекингом нескольких людей. 
- **VR/3D‑сценарии** и ориентация на 3D‑данные. 
- **Терапевтические сценарии** (упражнения, удержание поз). 
- **Метроном и регулировка скорости** для обучения. 
- **Внешние устройства** (танцевальные коврики и пр.) — как долгосрочная интеграция. 

## 4) Ревизия: что уже сделано, а что впереди

### Сделано (зафиксировано в истории и отражено в репозитории)
- Python‑ядро с MediaPipe/OpenCV и базовой логикой. 
- IPC через ZeroMQ: backend публикует кадры/метаданные, frontend получает и управляет. 
- Формат `.mtp v2` + базовые сервисы чтения/распаковки. 
- Avalonia‑клиент с таймлайном, отображением оверлеев и синхронизацией состояния с backend. 
- ADR‑фиксация ключевых решений (например, рендеринг оверлеев). 

### В работе / частично
- Полноценный редактор таймлайна: интерфейс готов, функциональность постепенного редактирования/сохранения развивается. 
- Исполнение таймлайна (активация оверлеев по времени) — частично реализовано, требует расширения по типам ассетов и трансформациям. 

### Запланировано
- Полный «Digitizer»‑пайплайн для различных источников (webcam/video) с богатыми метаданными. 
- Party Mode (multi‑person). 
- VR/3D‑расширения и API‑слой. 
- Мобильные клиенты и полноценная мультиплатформенность. 

---

Источник: подробная переписка и решения в `docs/history.txt`.
