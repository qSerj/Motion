# Спецификация формата .MTP (Motion Trainer Package)

**Версия:** 2.0 (Draft)
**Контейнер:** ZIP (Store или Deflate)
**Расширение:** `.mtp`

## 1. Философия
Формат MTP 2.0 разделяет "Сырые данные" (видео, скелет) и "Режиссуру" (таймлайн).
Рендеринг гибридный:
1.  **Backend (Python):** Управляет логикой, таймингом и анализом движений.
2.  **Frontend (C#):** Отрисовывает интерфейс, видео и накладывает визуальные эффекты (Overlay) поверх видео.

## 2. Структура архива

```text
level.mtp
├── manifest.json       # Метаданные (минимальный набор полей см. ниже)
├── patterns.json       # Данные скелета (углы)
├── video.mp4           # Основной трек (минимальный пакет от digitizer)
├── timeline.json       # (опционально) Сценарий событий
└── assets/             # (опционально) Медиа-ресурсы для оверлеев
    ├── overlay.png
    └── fire.gif

```

> Примечание: текущий digitizer создает минимальный пакет без `assets/` и без `timeline.json`.

## 3. Координатная система

Для всех визуальных элементов (картинки, видео, текст) используется **Нормализованная система координат (0.0 - 1.0)**, где:

* `(0, 0)` — Левый верхний угол видео.
* `(1, 1)` — Правый нижний угол видео.
* `(0.5, 0.5)` — Центр.

Это гарантирует, что уровень выглядит одинаково на экранах 4K и HD.

## 4. Файл manifest.json

```json
{
  "version": "2.0",
  "title": "Rasputin - Just Dance",
  "duration": 185.5,
  "files": {
    "video": "video.mp4",
    "patterns": "patterns.json",
    "timeline": "timeline.json"  // опционально
  }
}

```

Дополнительные поля (например, `id`, `author`) допускаются, но сейчас не используются в коде и не обязательны.

## 5. Файл timeline.json (Ядро версии 2.0, опционально)

Массив "Треков". Каждый трек содержит массив "Событий".

```json
{
  "tracks": [
    {
      "id": "visual_overlays",
      "events": [
        {
          "type": "image",
          "time": 5.2,          // Время старта (сек)
          "duration": 3.0,      // Длительность (сек)
          "asset": "assets/warn.png",
          "props": {
            "x": 0.1, "y": 0.1, // Позиция
            "w": 0.2,           // Ширина (высота авто)
            "opacity": 0.8,
            "animate": "fade_in"
          }
        }
      ]
    },
    {
      "id": "game_logic",
      "events": [
        {
          "type": "no_score_zone", // Не считать очки в этом промежутке
          "time": 0.0,
          "duration": 10.0
        }
      ]
    }
  ]
}

```

### Поддерживаемые overlay-события (текущий рендер)
- `image`: картинка из `asset` (путь внутри пакета, например `assets/logo.png`). `props` поддерживает `x`, `y`, `w`, а также опционально `rotation`/`r`, `scale`/`s`.
- `text`: текстовый оверлей. Текст берется из `asset`, либо из `props.text` если `asset` пустой.
