# Архитектура

## На высоком уровне
Motion Trainer сейчас состоит из:

- **Backend (Python)**: компьютерное зрение + игровой движок.
  - Захватывает позу пользователя (webcam), рисует скелет поверх пользовательского кадра.
  - Публикует кадры и метаданные (очки, время, оверлеи, прогресс оцифровки) через ZeroMQ PUB.
  - Принимает команды через ZeroMQ REP (load, pause, resume, restart, seek, get_state, stop, digitize).

- **Frontend (C# Avalonia)**: настольный UI.
  - Загружает уровни `.mtp v2` (zip с manifest + patterns + video + опциональными assets/timeline).
  - Рендерит оверлеи поверх видео/канваса.
  - Может отправлять команды управления в backend и отображать поток backend.

## Источник истины
- `.mtp v2` — контракт формата (docs/MTP_FORMAT_v2.md).
- Формат IPC-сообщений — контракт (docs/ipc.md).
- Семантика поведения описана в docs/TECH_SPEC.md.

## Поток данных
1) Уровень создаётся (digitizer) → архив `.mtp`.
2) Frontend загружает `.mtp` и готовит таймлайн + ассеты.
3) Backend может быть запущен для стриминга видео/метаданных; frontend подписывается и рендерит.
4) Действия пользователя в UI отправляют команды в backend (REQ/REP).

## Ключевые риски
- Тихий дрейф между документацией и реализацией (исправляется тестами + дисциплиной в документах).
- Жёсткая зависимость логики от real-time / webcam (исправляется выделением чистой логики и её тестированием).
